{% extends 'base.html' %}
{% block content %}
<style>
    .dashboard-container {
        max-width: 500px;
        margin: 0 auto;
        padding: 20px;
        padding-top: 150px;  /* –û—Ç—Å—Ç—É–ø –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–æ—Ç–∏–ø–∞ */
    }
    
    /* –ò–∫–æ–Ω–∫–∞ —Å–≤–µ—Ä—Ö—É - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è */
    .logo-icon {
        position: fixed;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: 120px;
        height: 120px;
        margin: 0;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 100;
    }
    
    .logo-icon a {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        text-decoration: none;
    }
    
    .logo-icon img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: 50%;
        cursor: pointer;
    }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–µ—Ä–∏–æ–¥–∞ */
    .period-card {
        background: rgba(255, 255, 255, 0.5);
        padding: 12px 24px;
        border-radius: 43px;
        text-align: center;
        font-size: 16px;
        font-weight: 500;
        color: #333;
        margin-bottom: 30px;
        display: block;
        width: 65%;
        margin-left: auto;
        margin-right: auto;
        box-sizing: border-box;
    }
    
    /* –î–≤–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –º–µ—Ç—Ä–∏–∫ */
    .metrics-row {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .metric-card {
        flex: 1;
        background: rgba(255, 255, 255, 0.5);
        padding: 20px;
        border-radius: 20px;
        text-align: center;
    }
    
    .metric-card h2 {
        font-size: 36px;
        font-weight: bold;
        margin: 0;
        color: #333;
    }
    
    .metric-card p {
        font-size: 14px;
        color: #333;
        margin: 8px 0 0;
    }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–∏–±—ã–ª–∏ */
    .profit-card {
        background: #514D4A;
        color: white;
        padding: 15px 25px;
        border-radius: 20px;
        text-align: center;
        margin-bottom: 20px;
    }
    
    .profit-card h2 {
        font-size: 42px;
        font-weight: bold;
        margin: 0;
        color: white;
    }
    
    .profit-card p {
        font-size: 14px;
        margin: 10px 0 0;
        opacity: 0.9;
        color: white;
    }
    
    /* –ö–Ω–æ–ø–∫–∞ –ü–æ–¥—Ä–æ–±–Ω–µ–µ */
    .details-btn {
        display: block;
        width: 65%;
        margin: 0 auto 20px;
        background: #B58358;
        color: white;
        padding: 15px;
        border-radius: 20px;
        text-align: center;
        text-decoration: none;
        font-size: 16px;
        font-weight: bold;
        border: none;
        cursor: pointer;
    }
    
    /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
    .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
        align-items: center;
        margin-top: 20px;
        margin-bottom: 20px;
    }
    
    .action-btn {
        display: block;
        width: 65%;
        padding: 15px;
        border-radius: 20px;
        text-align: center;
        text-decoration: none;
        font-size: 16px;
        border: none;
        cursor: pointer;
    }
    
    .action-btn-primary {
        background: #B58358;
        color: white;
        font-weight: bold;
    }
    
    .action-btn-secondary {
        background: rgba(255, 255, 255, 0.5);
        color: #333;
        font-weight: 500;
    }
    
    /* –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏) */
    .period-selector {
        text-align: center;
        margin-bottom: 20px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 15px;
        display: none;
    }
    
    .period-selector.active {
        display: block;
    }
    
    .period-selector form {
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: center;
    }
    
    .period-selector select,
    .period-selector input {
        padding: 8px 12px;
        border-radius: 10px;
        border: 1px solid #ddd;
        font-size: 14px;
    }
    
    .period-selector button {
        background: #B58358;
        color: white;
        padding: 8px 20px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
    }
    
    .toggle-period-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: #B58358;
        color: white;
        border: none;
        font-size: 20px;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        z-index: 100;
    }
    
    @media (min-width: 768px) {
        .dashboard-container {
            max-width: 600px;
            padding-top: 90px;
        }
        
        .action-buttons {
            max-width: 600px;
        }
        
        .metric-card h2 {
            font-size: 48px;
        }
        
        .profit-card h2 {
            font-size: 52px;
        }
    }
</style>

<!-- –ò–∫–æ–Ω–∫–∞ - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è -->
<div class="logo-icon">
    <a href="{{ url_for('dashboard') }}">
        <img src="{{ url_for('uploaded_file', filename='logo.png') }}" alt="Logo">
    </a>
</div>

<div class="dashboard-container">
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–µ—Ä–∏–æ–¥–∞ -->
    <div style="text-align: center; margin-bottom: 30px;">
        <div class="period-card">{{ period_label }}</div>
    </div>
    
    <!-- –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="period-selector" id="periodSelector">
        <form method="GET">
            <select name="period_type" onchange="toggleCustom(this.value)">
                <option value="current_month" {% if period_type == 'current_month' %}selected{% endif %}>–ú–µ—Å—è—Ü</option>
                <option value="custom" {% if period_type == 'custom' %}selected{% endif %}>–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</option>
            </select>

            <div id="month-select" style="display: flex; gap: 10px;">
                <select name="month">
                    {% for m in range(1,13) %}
                        <option value="{{ m }}" {% if m == selected_month %}selected{% endif %}>
                            {{ ['–Ø–Ω–≤–∞—Ä—å','–§–µ–≤—Ä–∞–ª—å','–ú–∞—Ä—Ç','–ê–ø—Ä–µ–ª—å','–ú–∞–π','–ò—é–Ω—å','–ò—é–ª—å','–ê–≤–≥—É—Å—Ç','–°–µ–Ω—Ç—è–±—Ä—å','–û–∫—Ç—è–±—Ä—å','–ù–æ—è–±—Ä—å','–î–µ–∫–∞–±—Ä—å'][m-1] }}
                        </option>
                    {% endfor %}
                </select>
                <select name="year">
                    {% for y in all_years %}
                        <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
                    {% endfor %}
                </select>
            </div>

            <div id="custom-dates" style="display: none; width: 100%;">
                <input type="date" name="start_date" value="{{ request.args.get('start_date', '') }}" style="width: 48%;">
                <input type="date" name="end_date" value="{{ request.args.get('end_date', '') }}" style="width: 48%;">
            </div>

            <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        </form>
    </div>
    
    <!-- –î–≤–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –º–µ—Ç—Ä–∏–∫ -->
    <div class="metrics-row">
        <div class="metric-card">
            <h2>{{ count_sales }}</h2>
            <p>–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ</p>
        </div>
        <div class="metric-card">
            <h2>{{ "%.0f"|format(gross_income) }}$</h2>
            <p>–î–æ—Ö–æ–¥</p>
        </div>
    </div>
    
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–∏–±—ã–ª–∏ -->
    <div class="profit-card">
        <h2>{{ "%.0f"|format(net_profit) }}$</h2>
        <p>–ü—Ä–∏–±—ã–ª—å —Å –≤—ã—á–µ—Ç–æ–º —Ä–∞—Å—Ö–æ–¥–æ–≤</p>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –ü–æ–¥—Ä–æ–±–Ω–µ–µ -->
    <a href="{{ url_for('sales') }}" class="details-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
    
    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="action-buttons">
        <a href="{{ url_for('add_sale') }}" class="action-btn action-btn-primary">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É</a>
        <a href="{{ url_for('all_sales_summary') }}" class="action-btn action-btn-secondary">–í—Å–µ –ø—Ä–æ–¥–∞–∂–∏</a>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞ -->
    <button class="toggle-period-btn" onclick="togglePeriodSelector()" title="–í—ã–±—Ä–∞—Ç—å –ø–µ—Ä–∏–æ–¥">üìÖ</button>
</div>

<script>
    function toggleCustom(val) {
        document.getElementById('month-select').style.display = val === 'current_month' ? 'flex' : 'none';
        document.getElementById('custom-dates').style.display = val === 'custom' ? 'flex' : 'none';
    }
    
    function togglePeriodSelector() {
        const selector = document.getElementById('periodSelector');
        selector.classList.toggle('active');
    }
    
    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å
    toggleCustom('{{ period_type }}');
</script>
{% endblock %}